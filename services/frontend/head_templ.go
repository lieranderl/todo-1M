// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package frontend

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func AppHead(title string) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var2 string
		templ_7745c5c3_Var2, templ_7745c5c3_Err = templ.JoinStringErrs(title)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `services/frontend/head.templ`, Line: 7, Col: 16}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var2))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "</title><link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\"><link href=\"/static/styles.css\" rel=\"stylesheet\"><script type=\"module\" src=\"https://cdn.jsdelivr.net/gh/starfederation/datastar@v1.0.0-RC.7/bundles/datastar.js\"></script><script>\n\t\t\t\t(() => {\n\t\t\t\t\tconst protectedPaths = new Set([\"/app\", \"/architecture\", \"/settings\"]);\n\t\t\t\t\tconst warnBeforeExpirySeconds = 60;\n\t\t\t\t\tconst checkIntervalMs = 15000;\n\n\t\t\t\tconst clearAuthStorage = () => {\n\t\t\t\t\tlocalStorage.removeItem(\"todo_access_token\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_refresh_token\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_username\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_user_id\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_active_group\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_connected_group\");\n\t\t\t\t\tlocalStorage.removeItem(\"todo_connected_group_name\");\n\t\t\t\t};\n\n\t\t\t\tconst parseTokenPayload = (token) => {\n\t\t\t\t\tconst parts = token.split(\".\");\n\t\t\t\t\tif (parts.length !== 3) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst base64 = parts[1].replace(/-/g, \"+\").replace(/_/g, \"/\");\n\t\t\t\t\t\tconst normalized = base64 + \"=\".repeat((4 - (base64.length % 4)) % 4);\n\t\t\t\t\t\tconst decoded = atob(normalized);\n\t\t\t\t\t\treturn JSON.parse(decoded);\n\t\t\t\t\t} catch (_err) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst formatRemaining = (seconds) => {\n\t\t\t\t\tconst mins = Math.floor(seconds / 60);\n\t\t\t\t\tconst secs = seconds % 60;\n\t\t\t\t\tconst pad = (n) => (n < 10 ? \"0\" + n : \"\" + n);\n\t\t\t\t\treturn `${mins}:${pad(secs)}`;\n\t\t\t\t};\n\n\t\t\t\t\tconst setNotice = (message) => {\n\t\t\t\t\t\tconst el = document.getElementById(\"session-notice\");\n\t\t\t\t\t\tif (!el) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst text = String(message || \"\").trim();\n\t\t\t\t\t\tif (text === \"\") {\n\t\t\t\t\t\t\thideNotice();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tel.textContent = text;\n\t\t\t\t\t\tel.hidden = false;\n\t\t\t\t\t\tel.style.display = \"\";\n\t\t\t\t\t\tel.setAttribute(\"aria-hidden\", \"false\");\n\t\t\t\t\t};\n\n\t\t\t\t\tconst hideNotice = () => {\n\t\t\t\t\t\tconst el = document.getElementById(\"session-notice\");\n\t\t\t\t\t\tif (!el) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tel.textContent = \"\";\n\t\t\t\t\t\tel.hidden = true;\n\t\t\t\t\t\tel.style.display = \"none\";\n\t\t\t\t\t\tel.setAttribute(\"aria-hidden\", \"true\");\n\t\t\t\t\t};\n\n\t\t\t\tconst redirectToLoginIfProtected = () => {\n\t\t\t\t\tif (!protectedPaths.has(window.location.pathname)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\twindow.location.assign(\"/login\");\n\t\t\t\t};\n\n\t\t\t\tconst evaluateSession = () => {\n\t\t\t\t\tconst token = localStorage.getItem(\"todo_access_token\") || \"\";\n\t\t\t\t\tif (token === \"\") {\n\t\t\t\t\t\thideNotice();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst payload = parseTokenPayload(token);\n\t\t\t\t\tif (!payload || typeof payload.exp !== \"number\") {\n\t\t\t\t\t\tclearAuthStorage();\n\t\t\t\t\t\tredirectToLoginIfProtected();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst nowSeconds = Math.floor(Date.now() / 1000);\n\t\t\t\t\tconst remaining = payload.exp - nowSeconds;\n\n\t\t\t\t\tif (remaining <= 0) {\n\t\t\t\t\t\tclearAuthStorage();\n\t\t\t\t\t\tredirectToLoginIfProtected();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (remaining <= warnBeforeExpirySeconds) {\n\t\t\t\t\t\tsetNotice(\"Session expires in \" + formatRemaining(remaining) + \". Click Refresh Token in /app or log in again.\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\thideNotice();\n\t\t\t\t};\n\n\t\t\t\t\tconst tick = () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tevaluateSession();\n\t\t\t\t\t\t} catch (_err) {\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\twindow.__todoSessionTick = tick;\n\t\t\t\t\ttick();\n\t\t\t\t\twindow.addEventListener(\"storage\", tick);\n\t\t\t\t\twindow.addEventListener(\"todo-auth-updated\", tick);\n\t\t\t\t\twindow.addEventListener(\"DOMContentLoaded\", () => {\n\t\t\t\t\t\ttick();\n\t\t\t\t\t\twindow.setInterval(tick, checkIntervalMs);\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t</script></head>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
